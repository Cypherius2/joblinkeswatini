<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In | JobLinkEswatini</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body class="auth-body">
    <div id="notification-container"></div>
    <div class="auth-container">
        <div class="auth-header">
            <a href="../index.html" class="logo-link">
                <h1 class="logo">JobLink<span class="logo-eswatini">Eswatini</span></h1>
            </a>
            
            <br>
            <button class="google-btn">
                <div class="google-icon-wrapper">
                    <img class="google-icon"
                        src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg"
                        alt="Google G Logo" />
                </div>
                <p class="btn-text">Sign in with Google</p>
            </button>
            <br>
        </div>

        <!-- The form itself no longer has a submit button inside it -->
        <form class="auth-form" id="loginForm">
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password" required>
            </div>
            <!-- The submit button has been moved outside the form -->
        </form>

        <!-- This is a standard button now, not a submit button -->
        <button class="auth-button" id="loginButton">Sign In</button>

        <div class="auth-footer">
            <p>New to JobLinkEswatini? <a href="signup.html">Join now</a></p>
        </div>
    </div>

    <nav class="mobile-nav">
        <a href="connect.html" class="mobile-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path
                    d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.998 3.998 0 0118 14v4h-2zM2 15a4 4 0 004 3v-3h-4z" />
            </svg>
            <span>Network</span>
        </a>
        <a href="jobs.html" class="mobile-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M6 6a2 2 0 00-2 2v3.586l1.293-1.293a1 1 0 011.414 0L9 10.586V12a1 1 0 102 0v-1.414l2.293-2.293a1 1 0 011.414 0L16 11.586V8a2 2 0 00-2-2H6z"
                    clip-rule="evenodd" />
                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
            </svg>
            <span>Jobs</span>
        </a>
        <a href="#" class="mobile-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
            </svg>
            <span>Messages</span>
        </a>
        <a href="edit-profile.html" class="mobile-nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 10-4 0 2 2 0 004 0zm-2 4a5 5 0 00-5 5h10a5 5 0 00-5-5z"
                    clip-rule="evenodd" />
            </svg>
            <span>Me</span>
        </a>
    </nav>
    <script src="../js/emergency-notifications.js"></script>
    <script src="../js/config.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/google-auth.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginButton = document.getElementById('loginButton');

            // Safety check to make sure the button exists
            if (loginButton) {
                loginButton.addEventListener('click', async () => {
                    const emailInput = document.getElementById('email');
                    const passwordInput = document.getElementById('password');

                    // Basic validation
                    if (!emailInput.value || !passwordInput.value) {
                        // Use the new notification function for front-end validation errors
                        showNotification('Please enter both email and password.', 'error');
                        return;
                    }

                    const loginData = {
                        email: emailInput.value,
                        password: passwordInput.value
                    };

                    try {
                        const response = await fetch(`${API_URL}/api/users/login`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(loginData)
                        });

                        const result = await response.json();

                        if (response.ok) {
                            // --- SUCCESS CASE ---
                            // Show a modern SUCCESS notification
                            showNotification('Login successful! Redirecting...');

                            localStorage.setItem('token', result.token);

                            // Redirect after a short delay so the user can see the notification
                            setTimeout(() => {
                                window.location.href = 'profile.html';
                            }, 1500); // 1.5 second delay

                        } else {
                            // --- ERROR CASE ---
                            // Show a modern ERROR notification with the message from the server
                            showNotification(result.msg || 'Invalid credentials.', 'error');
                        }
                    } catch (error) {
                        // --- FATAL ERROR CASE (e.g., server is down) ---
                        console.error('Login fetch failed:', error);
                        showNotification('Login failed. Could not connect to the server.', 'error');
                    }
                });
            }
        });
    </script>
</body>

</html>