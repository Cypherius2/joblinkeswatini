<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join JobLinkEswatini</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/theme-tech.css"> 
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Add your font links here if needed -->
</head>

<body class="auth-body">
    <div id="notification-container"></div>
    <div class="auth-container">
        <div class="auth-header">
            <a href="../index.html" class="logo-link">
                <h1 class="logo">JobLink<span class="logo-eswatini">Eswatini</span></h1>
            </a>
            
            <div style="position: absolute; top: 10px; right: 10px;">
                <a href="#" class="dropdown-link" id="themeToggle" style="font-size: 1.2rem; text-decoration: none;">
                    <span id="themeToggleIcon">ðŸŒ™</span>
                    <span id="themeToggleText" style="margin-left: 5px; font-size: 0.9rem;">Dark</span>
                </a>
            </div>
            
            <h2>Create Your Professional Account</h2>
        </div>

        <!-- The Google Button and Divider -->
        <button class="google-btn">
            <div class="google-icon-wrapper">
                <img class="google-icon"
                    src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg"
                    alt="Google G Logo" />
            </div>
            <p class="btn-text">Sign in with Google</p>
        </button>
        <br>
        <div class="divider">OR</div>

        <form class="auth-form" id="signupForm" novalidate>
            <!-- ROLE SELECTOR IS ALREADY HERE AND CORRECT -->
            <div class="form-group role-selector">
                <br>
                <div>
                    <input type="radio" id="role-seeker" name="role" value="seeker" checked>
                    <label for="role-seeker">Job Seeker</label>
                </div>
                <div>
                    <input type="radio" id="role-company" name="role" value="company">
                    <label for="role-company">Company / Employer</label>
                </div>
            </div>

            <!-- THIS IS THE NEWLY ADDED COMPANY NAME FIELD -->
            <!-- It will be hidden by default with CSS/JS -->
            <div class="form-group" id="companyNameGroup" style="display: none;">
                <label for="companyName">Company Name</label>
                <input type="text" id="companyName" placeholder="Enter your company's name">
            </div>

            <!-- The rest of the form -->
            <div class="form-group">
                <label for="fullName">Full Name (Contact Person)</label>
                <input type="text" id="fullName" placeholder="Enter your full name" required>
                <div class="error-message" id="fullNameError"></div>
            </div>
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" placeholder="Enter your email" required>
                <div class="error-message" id="emailError"></div>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Create a password (6+ characters)" required>
                <div class="error-message" id="passwordError"></div>
            </div>
            <button type="submit" class="auth-button">Agree & Join</button>
        </form>
        <div class="auth-footer">
            <p>Already on JobLinkEswatini? <a href="login.html">Sign In</a></p>
        </div>
    </div>
    <script src="../js/emergency-notifications.js"></script>
    <script src="../js/config.js"></script>
    <script src="../js/theme-toggle.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/google-auth.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // --- SCRIPT TO SHOW/HIDE THE COMPANY NAME FIELD ---
            const companyNameGroup = document.getElementById('companyNameGroup');
            const roleRadios = document.querySelectorAll('input[name="role"]');

            roleRadios.forEach(radio => {
                radio.addEventListener('change', (event) => {
                    if (event.target.value === 'company') {
                        companyNameGroup.style.display = 'block';
                    } else {
                        companyNameGroup.style.display = 'none';
                    }
                });
            });


            // --- SCRIPT TO HANDLE FORM SUBMISSION ---
            const form = document.getElementById('signupForm');
            form.addEventListener('submit', async function (event) {
                event.preventDefault();

                const fullName = document.getElementById('fullName').value;
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const role = document.querySelector('input[name="role"]:checked').value;

                const signupData = {
                    name: fullName,
                    email: email,
                    password: password,
                    role: role
                };

                // If the user is a company, add the company name to the data
                // (We don't actually save this to the User model yet, but it's good practice to include it)
                if (role === 'company') {
                    const companyName = document.getElementById('companyName').value;
                    if (!companyName) {
                        showNotification('Please enter a company name.');
                        return;
                    }
                    // signupData.companyName = companyName; // For future use
                }

                try {
                    const response = await fetch(`${API_URL}/api/users/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(signupData)
                    });

                    const result = await response.json();

                    if (response.ok) {
                        showNotification('Registration successful! Please sign in.');
                        window.location.href = 'login.html';
                    } else {
                        showNotification('Error: ' + result.msg);
                    }
                } catch (error) {
                    console.error('Signup failed:', error);
                    showNotification('Signup failed. Please try again later.');
                }
            });
        });
    </script>
</body>

</html>